<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black" />
        <title>
        </title>

		<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.1/themes/base/jquery-ui.css" />
        <link rel="stylesheet" href="https://ajax.aspnetcdn.com/ajax/jquery.mobile/1.2.0/jquery.mobile-1.2.0.min.css" />
        <link rel="stylesheet" href="my.css" />
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js">
        </script>
		<script src="http://code.jquery.com/ui/1.10.1/jquery-ui.js"></script>
        <script src="https://ajax.aspnetcdn.com/ajax/jquery.mobile/1.2.0/jquery.mobile-1.2.0.min.js">
        </script>
        <script src="my.js">
        </script>

		 <style>
			#progressbar .ui-progressbar-value {
			background-color: #f00;
			}
			#progressbar {
			background-color: #f00;
			background-image:none;
			}
			 .progress-label {
			float: left;
			margin-left: 50%;
			margin-top: 5px;
			font-weight: bold;
			text-shadow: 1px 1px 0 #fff;
			}
		</style>
    <style>
      #myCanvas {
        border: 1px solid #9C9898;
      }
    </style>
    <script>
//      var canvas = document.getElementById('myCanvas');
//      var context = canvas.getContext('2d');
//      var imageObj = new Image();
//      imageObj.onload = function() {
//        context.drawImage(imageObj, `69, 50);
//      };
//      imageObj.src = 'http://www.html5canvastutorials.com/demos/assets/darth-vader.jpg';
    </script>

        <script>
        	function draw_anim(context, x, y, iobj) { // context is the canvas 2d context.
        		if (iobj.source != null) {
    				//alert(context+' '+x+' '+y+' '+iobj.source+' '+iobj.current);
        	        context.drawImage(iobj.source, iobj.current * iobj.width, 0,
        	                          iobj.width, iobj.height,
        	                          x, y, iobj.width, iobj.height);
        		}
        	    iobj.current = (iobj.current + 1) % iobj.total_frames;
        	}

        	function on_body_load(img_obj) { // <body onload='on_body_load()'>...
        	    var canvas = document.getElementById('canvasElement');
        	                 // <canvas id='canvasElement' width='320' height='200'/>
        	    var context = canvas.getContext("2d");
        	    context.fillStyle = "rgba(256, 256, 256, 1)";
        	    context.fillRect(1, 1, 127, 127);
        	    //context.drawImage(img_obj.source, 69, 50);
        	    setInterval((function (c, i) {
        	                return function () {
        	                    draw_anim(c, 0, 0, i);
        	                };
        	    })(context, img_obj), 100);
        	}
        
        try {
        	$( document ).bind( "mobileinit", function() {
                // Make your jQuery Mobile framework configuration changes here!
                $.mobile.allowCrossDomainPages = true;
                $.support.cors = true; // need to be true
            });        

        	
        	$( '#systemStatusPage' ).live( 'pagebeforecreate',function(event) {
        		$( "#progressbar" ).progressbar({
	        		 value: 75,
	        		 change: function() {
	        			 $( ".progress-label" ).text( $( "#progressbar" ).progressbar( "value" ) + "%" );
	        		 }
	       		 });
      		});

        	$( '#systemStatusPage' ).live( 'pagebeforeshow',function(event){
        		$( '#refreshStatusPageButton' ).click();
  	      	});
          	
        	$( '#forgotPasswordPage' ).live( 'pagebeforeshow',function(event){
        		
        		/*var canvas = document.getElementById('myCanvas');
                var context = canvas.getContext('2d');
                var imageObj = new Image();
                imageObj.src = 'http://www.html5canvastutorials.com/demos/assets/darth-vader.jpg';
                context.drawImage(imageObj, 69, 50);
                */
    	        var img_obj = {
    	        	    'source': null,
    	        	    'current': 0,
    	        	    'total_frames': 27,
    	        	    'width': 128,
    	        	    'height': 128
    	        	};
            	var img = new Image();
        	    img_obj.source = img;  // we set the image source for our object.
            	img.src = 'dance2.gif'; // contains an image of size 256x16 with 16 frames of size 16x16
                on_body_load(img_obj);
                
  	      	});
          	
        	$( '#refreshStatusPageButton' ).live( 'click',function(event){
        		//$("#systemStatusInfo").html("");
        		/*
        		$.getJSON("http://api.flickr.com/services/feeds/photos_public.gne?jsoncallback=?",
        			{tags: "mount rainier",tagmode: "any", format: "json" },
        			function(data) {
	        			$.each(data.items, function(i,item){
    	    		 		$("<img/>").attr("src", item.media.m).appendTo("#systemStatusInfo");
	        			 	if ( i == 1 ) return false;
    	    		 	});
        			}
        		);
				*/
        		
        		/*
        		$.getJSON('test.json', function(data) {
       				var items = [];
       				$.each(data, function(key, val) {
       			  		items.push('<li id="' + key + '">' + val + '</li>');
        			});
       			  $('<ul/>', {
        			  'class': 'my-new-list',
        			  html: items.join('')
        			  }).appendTo('#systemStatusInfo');
        			});
        		*/
           		$.getJSON('http://authorservicessupport.com/lockton_qc/qcsvc.php?callback=?',
           			{
	           			login:  $("#textinput1").val(),
	            		pass: $("#textinput2").val()
           			},
         			function(data) {
           				if (data.error) {
           					alert (data.error);
           					$.mobile.changePage("#loginPage");
           				} else {
							$("#prodStatImage").attr("src",data.prodstatus==1?"go.png":"nogo.png");
							$("#qcStatImage").attr("src",data.qcstatus==1?"go.png":"nogo.png");
							var avail = Math.round(data.avail);
							$("#avgRespVal").html(data.avgresp);
							$("#sysAvailBar").css('width',avail+'%');
							$("#sysAvailVal").html(data.avail);
							$("#lastTrNameVal").html(data.lasttr.name);
							$("#lastTrDtVal").html(data.lasttr.ts);
							$("#lastUpdateVal").html(data.lastupd);
							progressbar = $( "#progressbar" );
							progressbar.find( ".ui-progressbar-value").css({"background": '#0F0'});
							progressbar.progressbar( "option", { value: Math.floor( data.avail )});
           				}
        		});
        		
        	});
		} catch (error) {
    		alert("error "+error);
			console.error("Your javascript has an error: " + error);
  		}
        </script>
    </head>
    <body>
        <div data-role="page" id="loginPage" data-theme="a" >
            <div data-role="header">
                <h3 id="Monitorosaurus">
                    Monitorasaurus
                </h3>
            </div>
            <div data-role="content">
				<form action="#systemStatusPage" method="get"> 
                <div data-role="fieldcontain">
                    <fieldset data-role="controlgroup" data-mini="true">
                        <label for="textinput1">
                            Login
                        </label>
                        <input name="login" id="textinput1" placeholder="" value="" type="text" />
                    </fieldset>
                </div>
                <div data-role="fieldcontain">
                    <fieldset data-role="controlgroup" data-mini="true">
                        <label for="textinput2">
                            Password
                        </label>
                        <input name="password" id="textinput2" placeholder="" value="" type="password" />
                    </fieldset>
                </div>
                <a data-role="button" href="#systemStatusPage">
                    Log In
                </a>
                <div>
                    <a href="#forgotPasswordPage" data-transition="fade">
                        forgot password?
                    </a>
                </div>
                </form>
            </div>
        </div> <!-- /loginPage -->

        <div data-role="page" id="systemStatusPage" data-theme="a" >
            <div data-role="header">
                <h3 id="Monitorosaurus">
                    Monitorasaurus
                </h3>
            </div>
            <div data-role="content">
	            <div id="systemStatusInfo">
	                <h4>
	                    Lockton System Status:
	                </h4>
	                <div style="padding-top: 0px; padding-bottom: 10px;">
	                    Last Update: <span id="lastUpdateVal">...</span>
	                </div>
	                <div style="padding-top: 10px; height: 32px; position: relative; border: 0px solid #b8b8b8;">
	                    <img id="qcStatImage" src="go.png" alt="image" style="position: absolute; top: 50%; left: 16px; margin-left: -16px; margin-top: -18px" />
	                    <div style="position: absolute; top: 50%; left: 60px; margin-left: -16px; margin-top: -12px">QC System Status</div> 
	                </div>
	                <div style="padding-top: 10px; height: 32px; position: relative; border: 0px solid #b8b8b8;">
	                    <img id="prodStatImage" src="nogo.png" alt="image" style="position: absolute; top: 50%; left: 16px; margin-left: -16px; margin-top: -18px" />
	                    <div style="position: absolute; top: 50%; left: 60px; margin-left: -16px; margin-top: -12px">Production System Status</div> 
	                </div>
	                <div style="padding-top: 10px;">
	                    System Availability (last 24 hours): 
		                <div id="progressbar"><div class="progress-label">Loading...</div></div>
            	        <!--
            	        <div style="height: 32px; position: relative; border: 0px solid #b8b8b8;">
	                    	<div style="background-color:red; width:100%; height:100%; position: absolute; top: 50%; left: 0px; margin-top: -16px"></div>
	                    	<div id="sysAvailBar" style="background-color:green; width:95%; height:100%; position: absolute; top: 50%; left: 0px; margin-top: -16px"></div>
	                    	<div id="sysAvailVal" style="position: absolute; top: 50%; left: 100%; margin-left: -50px; margin-top: -12px">93%</div>
	                	</div>
	                	--> 
	                	
	                </div>
   	                <div style="padding-top: 10px;">
	                    Average Response Time: <span id="avgRespVal">433</span> ms
	                </div>
   	                <div style="padding-top: 10px;">
	                    Last Transaction: <br/>
	                    <span id="lastTrNameVal">AAAAA</span> 
	                    <span id="lastTrDtVal">??</span>
	                </div>
	            </div>
                <a data-role="button" id="refreshStatusPageButton">
                    Refresh
                </a>
            </div>
        </div> <!-- /systemStatusPage -->

        <div data-role="page" id="forgotPasswordPage" data-theme="a" >
            <div data-role="header">
                <h3 id="Monitorosaurus">
                    Monitorasaurus
                </h3>
            </div>
            <div data-role="content">
				<!-- canvas id="myCanvas" width="578" height="400"></canvas> -->
				<canvas id='canvasElement' width='128' height='128'></canvas>
                <div data-role="fieldcontain">
                    <fieldset data-role="controlgroup" data-mini="true">
                        <label for="emailInput">
                            Email
                        </label>
                        <input name="email" id="emailInput" placeholder="" value="" type="text" />
                    </fieldset>
                </div>
                <a data-role="button" href="#loginPage">
                    Submit
                </a>
            </div>
        </div> <!-- /forgotPasswordPage -->

    </body>
</html>
